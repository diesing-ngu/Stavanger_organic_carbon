---
title: "Data exploration"
output: html_notebook
---

# Preparations

## Install packages

```{r packages, message=FALSE, warning=FALSE}
if(!require("pacman")) install.packages("pacman"); library(pacman)
p_load(here, 
       CAST,
       corrplot,
       ggplot2)
```


## Load required data

```{r load_data}
rm_resp <- read.csv(here("oc_stocks", "data", "interim", "rm_resp.csv"))
resp <- read_sf(here("oc_stocks", "data", "interim", "resp.shp"))
predictors <- rast(here("oc_stocks", "data", "interim", "predictors_aoi.tif"))
dep_areas <- read_sf(here("input_data", "depositional_areas.shp"))
```


# Data exploration

## Histogram of organic carbon stocks (kg/m^2)

```{r histogram_oc_stock, message=FALSE}
hist(rm_resp$OCS_kg_m2, breaks = 20, main ="", xlab = "Organic carbon stock (kg/m^2)")

jpeg(filename = here("oc_stocks", "figures", "histogram_ocs.jpg"), width = 15, height = 10, units = "cm", res = 300)
hist(rm_resp$OCS_kg_m2, breaks = 20, main ="", xlab = "Organic carbon stock (kg/m^2)")
dev.off()
```


## Distances in geographic space

Distances in geographic space are computed.

```{r geogr_space_dist, message=FALSE}
dist_geogr <- geodist(resp, 
                      dep_areas,
                      type = "geo"
                      )

p <- plot(dist_geogr, unit = "km")
p

jpeg(filename = here("oc_stocks", "figures", "geodist_plot.jpg"), width = 15, height = 10, units = "cm", res = 300)
p
dev.off()
```


## Correlation plot

```{r corr_plot}
corrplot.mixed(cor(rm_resp[, names(predictors)]), lower.col =  "black", tl.pos = "lt", number.cex = 0.6)

jpeg(filename = here("oc_stocks", "figures", "correlation_plot.jpg"), width = 24, height = 24, units = "cm", res = 300)
corrplot.mixed(cor(rm_resp[, names(predictors)]), lower.col =  "black", tl.pos = "lt", number.cex = 0.6)
dev.off()
```


## Environmental space

A visual check to what extent the samples cover the environmental space. This is useful as legacy data were used and no formal sampling design was applied in the analysis.

* Blue: Samples

* Grey: Environmental data (based on random subsample)

```{r}
smp <- as.data.frame(spatSample(x = predictors, size = nrow((rm_resp)), method = "random", na.rm = TRUE))


for (i in names(predictors)) {
    
  print(ggplot() +
          geom_density(data = rm_resp, aes(x=rm_resp[,i]),colour="cornflowerblue",fill="cornflowerblue", alpha=0.1,linewidth=1) +
          geom_density(data = smp, aes(x=smp[,i]), colour="grey",fill="grey", alpha=0.1, linewidth=1) +
          scale_x_continuous(name = names(rm_resp[i])))
        
}
```

